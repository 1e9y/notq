{% extends 'base.html' %}

{% block title %}{{posts[0]['title']}}{% endblock %}

{% block header %}
  <a class="navlink" href="/">главная</a>
  <a class="navlink" href="/new">новое</a>
  <a class="navlink" href="javascript:toggle('bestmenu')">лучшее</a>
  {% if g.user %}<a class="navlink" href="{{ url_for('blog.create') }}">написать</a>{% endif %}
  {% include 'blog/bestmenu.html' %}
{% endblock %}

{% block content %}
  {% for post in posts %}
    {% include 'blog/post_content.html' %}
    <form method="post" action="addcomment" id="sendanswer">
        <label for="text">Ответить</label>
        <input type="hidden" name="thing" value="{{ post['id'] }}">
        <textarea name="text"></textarea>
        <input type="submit" value="Отправить">
    </form>
    {% for comment in post['comments'] recursive %}
      <details {% if not comment['closed'] %}open="1"{% endif %} id="answer{{ comment['id'] }}">
        <summary class="{% if g.user and g.user['id'] == comment['author_id'] %}thiscommentheader{% else %}commentheader{% endif %}">
          <small><a class="vote" id="uvc{{comment['id']}}" {% if comment['id'] in cupvoted %} style="color: #00a000" {% endif %} href="javascript:votec({{post['id']}},{{comment['id']}},1,{{g.canVote}})" title="Больше такого">▲</a></small>
          <small id="nvc{{comment['id']}}" style="color:gray">{{comment['votes']}}</small>
          <small><a class="vote" id="dvc{{comment['id']}}" {% if comment['id'] in cdownvoted %} style="color: #f00000" {% endif %} href="javascript:votec({{post['id']}},{{comment['id']}},-1,{{g.canVote}})" title="Меньше такого">▼</a></small>
          <strong style="margin:4px">{% set username=comment['username'] %}{% include 'user.html' %}</strong>
          <small style="color:gray">{{ comment['created' ]}}</small>
        </summary>
        {{comment['rendered']|safe}}
        <small>
          <details>
            <summary><span class="inlineaction">ответить</span></summary>
            <form method="post" action="addcomment">
              <input type="hidden" name="thing" value="{{ post['id'] }}">
              <input type="hidden" name="parent" value="{{ comment['id'] }}">
              <textarea name="text"></textarea>
              <input type="submit" value="Отправить">
            </form>
          </details>
        </small>
        {% if comment.children -%}
            <ul>{{ loop(comment.children) }}</ul>
        {% endif %}
      </details>
    {% endfor %}
  {% endfor %}
{% endblock %}
